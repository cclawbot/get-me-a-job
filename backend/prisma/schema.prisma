// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model Job {
  id          Int      @id @default(autoincrement())
  title       String
  company     String
  location    String
  description String?
  salary      String?
  url         String?  @unique
  source      String   @default("manual") // seek, linkedin, indeed, manual
  status      String   @default("new")    // new, saved, applied, interviewing, offered, rejected
  postedDate  String?
  workType    String?  // full-time, part-time, contract, casual
  remote      Boolean  @default(false)
  keywords    String?  // JSON array of matched keywords
  notes       String?
  userId      String   @default("default")
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Application {
  id          Int      @id @default(autoincrement())
  jobId       Int
  status      String   // applied, interviewing, offered, rejected
  notes       String?
  appliedAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Profile {
  id            Int            @id @default(autoincrement())
  userId        String         @default("default") @unique
  name          String
  email         String?
  phone         String?
  summary       String?
  skills        String         // JSON array of skills
  experiences   WorkExperience[]
  educations    Education[]
  certifications Certification[]
  references    Reference[]
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
}

model WorkExperience {
  id          Int      @id @default(autoincrement())
  profileId   Int
  profile     Profile  @relation(fields: [profileId], references: [id], onDelete: Cascade)
  company     String
  title       String
  location    String?
  startDate   String
  endDate     String?
  current     Boolean  @default(false)
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Education {
  id          Int      @id @default(autoincrement())
  profileId   Int
  profile     Profile  @relation(fields: [profileId], references: [id], onDelete: Cascade)
  institution String
  degree      String
  field       String?
  startDate   String?
  endDate     String?
  gpa         String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Certification {
  id          Int      @id @default(autoincrement())
  profileId   Int
  profile     Profile  @relation(fields: [profileId], references: [id], onDelete: Cascade)
  name        String
  issuer      String
  date        String?
  url         String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Reference {
  id          Int      @id @default(autoincrement())
  profileId   Int
  profile     Profile  @relation(fields: [profileId], references: [id], onDelete: Cascade)
  name        String
  title       String
  company     String?
  email       String?
  phone       String?
  relationship String?  // e.g., "Former Manager", "Colleague", "Client"
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Story {
  id              Int      @id @default(autoincrement())
  userId          String   @default("default")
  title           String
  situation       String   // STAR: Situation
  task            String   // STAR: Task
  action          String   // STAR: Action
  result          String   // STAR: Result
  tags            String   // JSON array of tags/keywords
  metrics         String?  // Quantifiable achievements
  interviewScript String?  // Cached interview script (JSON)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

model TailoredResume {
  id              Int      @id @default(autoincrement())
  userId          String   @default("default")
  jobTitle        String
  company         String?
  jobDescription  String   // Original JD
  content         String   // Generated tailored resume content (JSON)
  keywords        String   // Extracted keywords (JSON array)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}
